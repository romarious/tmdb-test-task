(this["webpackJsonptmdb-test-task"]=this["webpackJsonptmdb-test-task"]||[]).push([[0],{69:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(11),s=a.n(c),o=a(95),i=a(71),u=a(41),d=a(26),l=function(){return Object(d.b)()},g=d.c,j=a(22),f=a(28),b=a(38),v=a.n(b),m=a(44),p="d1266c529d5c989c867acb40d8dab16f",h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise((function(t){return setTimeout(t,e)}))};function O(){return(O=Object(m.a)(v.a.mark((function e(t){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(500+2e3*Math.random());case 2:if(!(Math.random()>.6)){e.next=4;break}throw new Error("Error for demonstration purposes - retry loading pressing on the desired page number again");case 4:return e.next=6,fetch("https://api.themoviedb.org/3/movie/top_rated?api_key=".concat(p,"&page=").concat(t));case 6:return a=e.sent,e.next=9,a.json();case 9:if(r=e.sent,200===a.status){e.next=12;break}throw new Error("Failed to load movies, because of [".concat(a.status,"] ").concat(r.status_code," ").concat(r.status_message));case 12:return e.abrupt("return",r.results.map((function(e){return{id:e.id,image:"https://image.tmdb.org/t/p/w300/".concat(e.poster_path),title:e.title,overview:e.overview,rating:e.vote_average,year:e.release_date.substr(0,4)}})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x,I="movies",y="top500_favorites";!function(e){e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.SUCCEEDED=2]="SUCCEEDED",e[e.FAILED=3]="FAILED"}(x||(x={}));var w=Object(j.c)({selectId:function(e){return e.id}}),E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x.IDLE;return{data:w.getInitialState(),status:e,error:null}},S={currentPageIndex:1,requestedPage:null,pages:{},favorites:function(){var e,t=String(localStorage.getItem(y));try{e=JSON.parse(t)}catch(a){}return Array.isArray(e)&&e.every((function(e){return"number"===typeof e}))?e:[]}()},C=Object(j.b)("".concat(I,"/fetchMovies"),(function(e){return O.apply(this,arguments)})),D=Object(j.d)({name:I,initialState:S,reducers:{setFavorite:function(e,t){var a,r=t.payload.flag,n=t.payload.id,c=e.favorites.includes(n);if(r){if(c)return e;e.favorites.push(n)}else{if(!c)return e;var s=e.favorites.findIndex((function(e){return e===n}));e.favorites.splice(s,1)}try{a=JSON.stringify(e.favorites)}catch(o){a="[]",e.favorites=[]}localStorage.setItem(y,a)},setCurrentPage:function(e,t){e.currentPageIndex=t.payload,e.requestedPage=null}},extraReducers:function(e){e.addCase(C.pending,(function(e,t){var a=t.meta.arg;e.pages[a]||(e.pages[a]=E(x.LOADING)),e.pages[a].status=x.LOADING,e.requestedPage=a})),e.addCase(C.fulfilled,(function(e,t){var a=t.meta.arg,r=e.pages[a];w.addMany(r.data,t.payload),r.status=x.SUCCEEDED,e.requestedPage===a&&(e.currentPageIndex=a)})),e.addCase(C.rejected,(function(e,t){var a=t.meta.arg,r=e.pages[a];r.error=t.error.message||"Request failed",r.status=x.FAILED}))}}),P=D.reducer,q=D.actions,N=function(e){return function(t,a){var r=L(a()),n=r.pages[e];e===r.currentPageIndex&&n&&n.status===x.SUCCEEDED||(n&&n.status===x.SUCCEEDED?t(q.setCurrentPage(e)):n&&![x.IDLE,x.FAILED].includes(n.status)||t(C(e)))}},L=function(e){return e.movies},F=Object(f.a)([L],(function(e){return e.favorites})),k=Object(f.a)([L],(function(e){return e.currentPageIndex})),A=Object(f.a)([L],(function(e){return e.requestedPage})),M=Object(f.a)([L,k],(function(e,t){return e.pages[t]||E()})),R=Object(f.a)([L,A],(function(e,t){return"number"===typeof t&&e.pages[t]||E()})),_=Object(f.a)([M],(function(e){return e.status})),U=Object(f.a)([R],(function(e){return e.status})),B=Object(f.a)([R],(function(e){return e.status===x.FAILED?e.error:null})),G=Object(f.a)([M],(function(e){return e.status===x.SUCCEEDED?e.data:w.getInitialState()})),z=w.getSelectors(G),J=z.selectIds,T={selectCurrentPageIndex:k,selectCurrentPageStatus:_,selectMovieById:z.selectById,selectMovieFavoriteFlag:Object(f.a)([F,function(e,t){return t}],(function(e,t){return e.includes(t)})),selectMovieIds:J,selectRequestedPageError:B,selectRequestedPageIndex:A,selectRequestedPageStatus:U},W=a(89),Y=a(96),H=a(90),$=a(91),K=a(92),Q=a(101),V=a(3),X=Object(W.a)({root:{flexGrow:1},favorite:{backgroundColor:"#fbf7e4"},poster:{width:"100%"},head:{display:"grid",gridTemplateColumns:"1fr 30px"},title:{fontSize:"2.5vw"},overview:{fontSize:"1.5vw"},textSecondary:{fontSize:"1vw"}}),Z=function(e){var t=e.movieId,a=X(),r=g((function(e){return T.selectMovieById(e,t)})),n=g((function(e){return T.selectMovieFavoriteFlag(e,t)})),c=l();return Object(V.jsx)(Y.a,{marginY:2,children:Object(V.jsxs)(H.a,{className:"".concat(a.root," ").concat(n?a.favorite:""),container:!0,spacing:2,component:$.a,alignItems:"stretch",children:[Object(V.jsx)(H.a,{item:!0,xs:2,children:Object(V.jsx)("img",{src:r.image,alt:"",className:a.poster})}),Object(V.jsxs)(H.a,{item:!0,xs:10,container:!0,direction:"column",justify:"space-between",children:[Object(V.jsxs)(H.a,{item:!0,className:a.head,children:[Object(V.jsx)(Y.a,{children:Object(V.jsx)(K.a,{href:"https://www.themoviedb.org/movie/".concat(r.id),target:"_blank",rel:"noreferrer",children:Object(V.jsx)(i.a,{className:a.title,variant:"body2",component:"span",children:r.title})})}),Object(V.jsx)(Q.a,{name:"favorite-".concat(t),value:n?1:0,onChange:function(e,a){c(q.setFavorite({id:t,flag:!!a}))},max:1})]}),Object(V.jsx)(H.a,{item:!0,children:Object(V.jsx)(i.a,{variant:"body2",className:a.overview,children:r.overview})}),Object(V.jsxs)(H.a,{item:!0,container:!0,direction:"row",justify:"space-between",children:[Object(V.jsx)(H.a,{item:!0,children:Object(V.jsxs)(i.a,{variant:"body2",className:a.textSecondary,color:"textSecondary",children:["Year: ",r.year]})}),Object(V.jsx)(H.a,{item:!0,children:Object(V.jsxs)(i.a,{variant:"body2",className:a.textSecondary,color:"textSecondary",align:"right",children:["Rating: ",r.rating]})})]})]})]})})},ee=a(97),te=a(40),ae=a(50),re=a(94),ne=a(72),ce=a(100),se=a(103),oe=Object(ne.a)({wrapper:{display:"grid",gridTemplateColumns:"30px 1fr"},pagination:{display:"block",margin:"0 auto",width:"fit-content"},requested:{border:"1px solid #eee"}}),ie=function(e){var t=e.loading,a=e.requestedPage,r=Object(ae.a)(e,["loading","requestedPage"]),n=oe();return Object(V.jsxs)(Y.a,{className:n.wrapper,children:[t?Object(V.jsx)(re.a,{size:20}):Object(V.jsx)("div",{}),Object(V.jsx)(se.a,Object(te.a)({className:n.pagination,siblingCount:2,boundaryCount:2,count:25,shape:"rounded",renderItem:function(e){var t=e.page===a?n.requested:"";return Object(V.jsx)(ce.a,Object(te.a)({className:t},e))}},r))]})},ue=a(99),de=function(){var e=l(),t=g(T.selectCurrentPageIndex),a=g(T.selectMovieIds),n=g(T.selectCurrentPageStatus),c=g(T.selectRequestedPageIndex),s=g(T.selectRequestedPageStatus),o=g(T.selectRequestedPageError);Object(r.useEffect)((function(){n===x.IDLE&&e(N(t))}),[n,t,e]);var i=Object(r.useState)(!1),d=Object(u.a)(i,2),j=d[0],f=d[1],b=Object(r.useState)("Something went wrong..."),v=Object(u.a)(b,2),m=v[0],p=v[1],h=function(e,t){"clickaway"!==t&&f(!1)};Object(r.useEffect)((function(){s===x.FAILED&&(p(o||"Something went wrong..."),f(!0))}),[c,s,o]);var O=s===x.LOADING,I=Object(V.jsx)(ie,{onChange:function(t,a){e(N(a))},page:t,requestedPage:c,loading:O,defaultPage:1});return Object(V.jsxs)(V.Fragment,{children:[I,Object(V.jsx)(ee.a,{open:j,autoHideDuration:6e3,onClose:h,children:Object(V.jsx)(ue.a,{onClose:h,severity:"error",children:m})}),n===x.SUCCEEDED&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Y.a,{children:a.map((function(e){return Object(V.jsx)(Z,{movieId:e},e)}))}),"pagination"]})]})},le=function(){return Object(V.jsxs)(o.a,{children:[Object(V.jsx)(i.a,{variant:"h3",component:"h1",align:"center",children:"TMDB top 500 movies"}),Object(V.jsx)(de,{})]})},ge=a(32),je=Object(j.a)({reducer:Object(ge.a)({},I,P)});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(Object(V.jsx)(n.a.StrictMode,{children:Object(V.jsx)(d.a,{store:je,children:Object(V.jsx)(le,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[69,1,2]]]);
//# sourceMappingURL=main.aeb9995b.chunk.js.map