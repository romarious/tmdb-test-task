(this["webpackJsonptmdb-test-task"]=this["webpackJsonptmdb-test-task"]||[]).push([[0],{69:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(11),s=a.n(c),o=a(95),i=a(71),u=a(41),d=a(26),l=function(){return Object(d.b)()},g=d.c,j=a(22),f=a(28),b=a(38),v=a.n(b),m=a(44),p="d1266c529d5c989c867acb40d8dab16f",h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise((function(t){return setTimeout(t,e)}))},O=!1;function x(){return(x=Object(m.a)(v.a.mark((function e(t){var a,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(500+2e3*Math.random());case 2:if(O||!(Math.random()>.5)){e.next=5;break}throw O=!0,new Error("Error for demonstration purposes - retry loading pressing on the desired page number again");case 5:return O=!1,e.next=8,fetch("https://api.themoviedb.org/3/movie/top_rated?api_key=".concat(p,"&page=").concat(t));case 8:return a=e.sent,e.next=11,a.json();case 11:if(r=e.sent,200===a.status){e.next=14;break}throw new Error("Failed to load movies, because of [".concat(a.status,"] ").concat(r.status_code," ").concat(r.status_message));case 14:return e.abrupt("return",r.results.map((function(e){return{id:e.id,image:"https://image.tmdb.org/t/p/w300/".concat(e.poster_path),title:e.title,overview:e.overview,rating:e.vote_average,year:e.release_date.substr(0,4)}})));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I,y="movies",w="top500_favorites";!function(e){e[e.IDLE=0]="IDLE",e[e.LOADING=1]="LOADING",e[e.SUCCEEDED=2]="SUCCEEDED",e[e.FAILED=3]="FAILED"}(I||(I={}));var E=Object(j.c)({selectId:function(e){return e.id}}),S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.IDLE;return{data:E.getInitialState(),status:e,error:null}},C={currentPageIndex:1,requestedPage:null,pages:{},favorites:function(){var e,t=String(localStorage.getItem(w));try{e=JSON.parse(t)}catch(a){}return Array.isArray(e)&&e.every((function(e){return"number"===typeof e}))?e:[]}()},D=Object(j.b)("".concat(y,"/fetchMovies"),(function(e){return x.apply(this,arguments)})),P=Object(j.d)({name:y,initialState:C,reducers:{setFavorite:function(e,t){var a,r=t.payload.flag,n=t.payload.id,c=e.favorites.includes(n);if(r){if(c)return e;e.favorites.push(n)}else{if(!c)return e;var s=e.favorites.findIndex((function(e){return e===n}));e.favorites.splice(s,1)}try{a=JSON.stringify(e.favorites)}catch(o){a="[]",e.favorites=[]}localStorage.setItem(w,a)},setCurrentPage:function(e,t){e.currentPageIndex=t.payload,e.requestedPage=null}},extraReducers:function(e){e.addCase(D.pending,(function(e,t){var a=t.meta.arg;e.pages[a]||(e.pages[a]=S(I.LOADING)),e.pages[a].status=I.LOADING,e.requestedPage=a})),e.addCase(D.fulfilled,(function(e,t){var a=t.meta.arg,r=e.pages[a];E.addMany(r.data,t.payload),r.status=I.SUCCEEDED,e.requestedPage===a&&(e.currentPageIndex=a)})),e.addCase(D.rejected,(function(e,t){var a=t.meta.arg,r=e.pages[a];r.error=t.error.message||"Request failed",r.status=I.FAILED}))}}),q=P.reducer,N=P.actions,L=function(e){return function(t,a){var r=F(a()),n=r.pages[e];e===r.currentPageIndex&&n&&n.status===I.SUCCEEDED||(n&&n.status===I.SUCCEEDED?t(N.setCurrentPage(e)):n&&![I.IDLE,I.FAILED].includes(n.status)||t(D(e)))}},F=function(e){return e.movies},k=Object(f.a)([F],(function(e){return e.favorites})),A=Object(f.a)([F],(function(e){return e.currentPageIndex})),M=Object(f.a)([F],(function(e){return e.requestedPage})),R=Object(f.a)([F,A],(function(e,t){return e.pages[t]||S()})),_=Object(f.a)([F,M],(function(e,t){return"number"===typeof t&&e.pages[t]||S()})),U=Object(f.a)([R],(function(e){return e.status})),B=Object(f.a)([_],(function(e){return e.status})),G=Object(f.a)([_],(function(e){return e.status===I.FAILED?e.error:null})),z=Object(f.a)([R],(function(e){return e.status===I.SUCCEEDED?e.data:E.getInitialState()})),J=E.getSelectors(z),T=J.selectIds,W={selectCurrentPageIndex:A,selectCurrentPageStatus:U,selectMovieById:J.selectById,selectMovieFavoriteFlag:Object(f.a)([k,function(e,t){return t}],(function(e,t){return e.includes(t)})),selectMovieIds:T,selectRequestedPageError:G,selectRequestedPageIndex:M,selectRequestedPageStatus:B},Y=a(89),H=a(96),$=a(90),K=a(91),Q=a(92),V=a(101),X=a(3),Z=Object(Y.a)({root:{flexGrow:1},favorite:{backgroundColor:"#fbf7e4"},poster:{width:"100%"},head:{display:"grid",gridTemplateColumns:"1fr 30px"},title:{fontSize:"2.5vw"},overview:{fontSize:"1.5vw"},textSecondary:{fontSize:"1vw"}}),ee=function(e){var t=e.movieId,a=Z(),r=g((function(e){return W.selectMovieById(e,t)})),n=g((function(e){return W.selectMovieFavoriteFlag(e,t)})),c=l();return Object(X.jsx)(H.a,{marginY:2,children:Object(X.jsxs)($.a,{className:"".concat(a.root," ").concat(n?a.favorite:""),container:!0,spacing:2,component:K.a,alignItems:"stretch",children:[Object(X.jsx)($.a,{item:!0,xs:2,children:Object(X.jsx)("img",{src:r.image,alt:"",className:a.poster})}),Object(X.jsxs)($.a,{item:!0,xs:10,container:!0,direction:"column",justify:"space-between",children:[Object(X.jsxs)($.a,{item:!0,className:a.head,children:[Object(X.jsx)(H.a,{children:Object(X.jsx)(Q.a,{href:"https://www.themoviedb.org/movie/".concat(r.id),target:"_blank",rel:"noreferrer",children:Object(X.jsx)(i.a,{className:a.title,variant:"body2",component:"span",children:r.title})})}),Object(X.jsx)(V.a,{name:"favorite-".concat(t),value:n?1:0,onChange:function(e,a){c(N.setFavorite({id:t,flag:!!a}))},max:1})]}),Object(X.jsx)($.a,{item:!0,children:Object(X.jsx)(i.a,{variant:"body2",className:a.overview,children:r.overview})}),Object(X.jsxs)($.a,{item:!0,container:!0,direction:"row",justify:"space-between",children:[Object(X.jsx)($.a,{item:!0,children:Object(X.jsxs)(i.a,{variant:"body2",className:a.textSecondary,color:"textSecondary",children:["Year: ",r.year]})}),Object(X.jsx)($.a,{item:!0,children:Object(X.jsxs)(i.a,{variant:"body2",className:a.textSecondary,color:"textSecondary",align:"right",children:["Rating: ",r.rating]})})]})]})]})})},te=a(97),ae=a(40),re=a(50),ne=a(94),ce=a(72),se=a(100),oe=a(103),ie=Object(ce.a)({wrapper:{display:"grid",gridTemplateColumns:"30px 1fr"},pagination:{display:"block",margin:"0 auto",width:"fit-content"},requested:{border:"1px solid #eee"}}),ue=function(e){var t=e.loading,a=e.requestedPage,r=Object(re.a)(e,["loading","requestedPage"]),n=ie();return Object(X.jsxs)(H.a,{className:n.wrapper,children:[t?Object(X.jsx)(ne.a,{size:20}):Object(X.jsx)("div",{}),Object(X.jsx)(oe.a,Object(ae.a)({className:n.pagination,siblingCount:2,boundaryCount:2,count:25,shape:"rounded",renderItem:function(e){var t=e.page===a?n.requested:"";return Object(X.jsx)(se.a,Object(ae.a)({className:t},e))}},r))]})},de=a(99),le=function(){var e=l(),t=g(W.selectCurrentPageIndex),a=g(W.selectMovieIds),n=g(W.selectCurrentPageStatus),c=g(W.selectRequestedPageIndex),s=g(W.selectRequestedPageStatus),o=g(W.selectRequestedPageError);Object(r.useEffect)((function(){n===I.IDLE&&e(L(t))}),[n,t,e]);var i=Object(r.useState)(!1),d=Object(u.a)(i,2),j=d[0],f=d[1],b=Object(r.useState)("Something went wrong..."),v=Object(u.a)(b,2),m=v[0],p=v[1],h=function(e,t){"clickaway"!==t&&f(!1)};Object(r.useEffect)((function(){s===I.FAILED&&(p(o||"Something went wrong..."),f(!0))}),[c,s,o]);var O=s===I.LOADING,x=Object(X.jsx)(ue,{onChange:function(t,a){e(L(a))},page:t,requestedPage:c,loading:O,defaultPage:1});return Object(X.jsxs)(X.Fragment,{children:[x,Object(X.jsx)(te.a,{open:j,autoHideDuration:6e3,onClose:h,children:Object(X.jsx)(de.a,{onClose:h,severity:"error",children:m})}),n===I.SUCCEEDED&&Object(X.jsxs)(X.Fragment,{children:[Object(X.jsx)(H.a,{children:a.map((function(e){return Object(X.jsx)(ee,{movieId:e},e)}))}),x]})]})},ge=function(){return Object(X.jsxs)(o.a,{children:[Object(X.jsx)(i.a,{variant:"h3",component:"h1",align:"center",children:"TMDB top 500 movies"}),Object(X.jsx)(le,{})]})},je=a(32),fe=Object(j.a)({reducer:Object(je.a)({},y,q)});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(Object(X.jsx)(n.a.StrictMode,{children:Object(X.jsx)(d.a,{store:fe,children:Object(X.jsx)(ge,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[69,1,2]]]);
//# sourceMappingURL=main.5dfd9012.chunk.js.map